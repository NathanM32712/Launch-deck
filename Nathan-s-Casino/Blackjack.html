<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blackjack</title>

<!-- Correct favicon -->
<link rel="icon" type="image/png" href="../icon.png">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0b0b16;
    color: #f5f5f5;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 40px 20px;
  }

  /* Back button */
  .back-btn {
    position: fixed;
    top: 10px;
    left: 10px;
    width: 40px;
    height: 40px;
    background-image: url('../icon.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer;
    z-index: 9999;
  }

  .game {
    background: #15152a;
    border-radius: 12px;
    padding: 20px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
  }

  h1 {
    text-align: center;
    margin-top: 0;
  }

  .balance {
    font-size: 1.1em;
    margin-bottom: 10px;
    text-align: center;
  }

  .row {
    margin-bottom: 10px;
    text-align: center;
  }

  input[type="number"] {
    width: 100px;
    padding: 6px;
    border-radius: 6px;
    border: none;
    background: #0b0b16;
    color: white;
  }

  button {
    padding: 10px 16px;
    margin: 5px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: #4ecca3;
    color: #051923;
    font-weight: bold;
  }

  button:disabled {
    background: #555;
    cursor: default;
  }

  .section {
    background: #101020;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
  }

  .cards span {
    display: inline-block;
    padding: 6px 10px;
    margin-right: 6px;
    background: #202040;
    border-radius: 4px;
  }

  .status {
    margin-top: 12px;
    min-height: 24px;
    text-align: center;
  }
</style>
</head>
<body>

<a class="back-btn" href="../launch-deck.html"></a>

<div class="game">
  <h1>Blackjack</h1>

  <div class="balance">
    Balance: $<span id="balance">0</span>
  </div>

  <div class="row">
    Bet: <input type="number" id="bet" min="1" value="10">
    <button id="dealBtn">Deal</button>
  </div>

  <div class="section">
    <h3>Dealer</h3>
    <div class="cards" id="dealerCards"></div>
    <div>Total: <span id="dealerTotal">0</span></div>
  </div>

  <div class="section">
    <h3>Player</h3>
    <div class="cards" id="playerCards"></div>
    <div>Total: <span id="playerTotal">0</span></div>
  </div>

  <div class="row">
    <button id="hitBtn" disabled>Hit</button>
    <button id="standBtn" disabled>Stand</button>
  </div>

  <div class="status" id="status"></div>
</div>

<script>
/* ---------------- COOKIE HELPERS ---------------- */
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/`;
}

function getCookie(name) {
  const cname = name + "=";
  const arr = decodeURIComponent(document.cookie).split(";");
  for (let c of arr) {
    c = c.trim();
    if (c.indexOf(cname) === 0) return c.substring(cname.length);
  }
  return null;
}

/* ---------------- BALANCE ---------------- */
let balance = 0;

function loadBalance() {
  const stored = getCookie("balance");
  balance = stored && !isNaN(stored) ? parseInt(stored) : 0;
  updateBalance();
}

function updateBalance() {
  document.getElementById("balance").textContent = balance;
}

function saveBalance() {
  setCookie("balance", balance, 365);
  updateBalance();
}

/* ---------------- GAME LOGIC ---------------- */
let deck = [];
let player = [];
let dealer = [];
let inRound = false;
let currentBet = 0;

function createDeck() {
  const suits = ["â™ ","â™¥","â™¦","â™£"];
  const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const d = [];
  for (let s of suits) {
    for (let r of ranks) d.push({rank:r, suit:s});
  }
  return d;
}

function shuffle(a) {
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function dealCard(hand) {
  if (deck.length === 0) deck = shuffle(createDeck());
  hand.push(deck.pop());
}

function handValue(hand) {
  let total = 0;
  let aces = 0;

  for (let c of hand) {
    if (c.rank === "A") {
      aces++;
      total += 11;
    } else if (["K","Q","J"].includes(c.rank)) {
      total += 10;
    } else {
      total += parseInt(c.rank);
    }
  }

  while (total > 21 && aces > 0) {
    total -= 10;
    aces--;
  }

  return total;
}

function renderHand(hand, element, hideFirst=false) {
  element.innerHTML = "";
  hand.forEach((c, i) => {
    const span = document.createElement("span");
    span.textContent = hideFirst && i === 0 ? "ðŸ‚ " : c.rank + c.suit;
    element.appendChild(span);
  });
}

/* ---------------- ROUND CONTROL ---------------- */
function startRound() {
  if (inRound) return;

  const bet = parseInt(document.getElementById("bet").value);
  if (!bet || bet <= 0) {
    status("Enter a valid bet.");
    return;
  }
  if (bet > balance) {
    status("Not enough balance.");
    return;
  }

  currentBet = bet;
  balance -= bet;
  saveBalance();

  inRound = true;
  player = [];
  dealer = [];
  deck = shuffle(createDeck());

  dealCard(player);
  dealCard(dealer);
  dealCard(player);
  dealCard(dealer);

  renderHand(player, document.getElementById("playerCards"));
  renderHand(dealer, document.getElementById("dealerCards"), true);

  document.getElementById("playerTotal").textContent = handValue(player);
  document.getElementById("dealerTotal").textContent = "?";

  document.getElementById("hitBtn").disabled = false;
  document.getElementById("standBtn").disabled = false;
  document.getElementById("dealBtn").disabled = true;

  status("Hit or Stand");
}

function hit() {
  if (!inRound) return;

  dealCard(player);
  renderHand(player, document.getElementById("playerCards"));
  const val = handValue(player);
  document.getElementById("playerTotal").textContent = val;

  if (val > 21) endRound();
}

function stand() {
  if (!inRound) return;
  endRound();
}

function endRound() {
  let playerVal = handValue(player);
  let dealerVal = handValue(dealer);

  while (dealerVal < 17) {
    dealCard(dealer);
    dealerVal = handValue(dealer);
  }

  renderHand(dealer, document.getElementById("dealerCards"));
  document.getElementById("dealerTotal").textContent = dealerVal;
  document.getElementById("playerTotal").textContent = playerVal;

  if (playerVal > 21) {
    status("You busted.");
  } else if (dealerVal > 21) {
    status("Dealer busts â€” you win!");
    balance += currentBet * 2;
  } else if (playerVal > dealerVal) {
    status("You win!");
    balance += currentBet * 2;
  } else if (playerVal < dealerVal) {
    status("Dealer wins.");
  } else {
    status("Push â€” bet returned.");
    balance += currentBet;
  }

  saveBalance();

  inRound = false;
  document.getElementById("hitBtn").disabled = true;
  document.getElementById("standBtn").disabled = true;
  document.getElementById("dealBtn").disabled = false;
}

function status(msg) {
  document.getElementById("status").textContent = msg;
}

/* ---------------- INIT ---------------- */
document.getElementById("dealBtn").onclick = startRound;
document.getElementById("hitBtn").onclick = hit;
document.getElementById("standBtn").onclick = stand;

loadBalance();
</script>

</body>
</html>

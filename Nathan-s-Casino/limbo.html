<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Limbo</title>

<!-- Favicon -->
<link rel="icon" type="image/png" href="../icon.png">

<style>
  body {
    background:#0d0d16;
    color:white;
    font-family:Arial, sans-serif;
    display:flex;
    justify-content:center;
    padding-top:60px;
  }

  /* Back Button */
  .back-btn {
    position:fixed;
    top:10px;
    left:10px;
    width:40px;
    height:40px;
    background-image:url('../icon.png');
    background-size:contain;
    background-repeat:no-repeat;
    background-position:center;
    cursor:pointer;
    z-index:9999;
  }

  .game {
    background:#1a1a2e;
    padding:25px;
    border-radius:12px;
    width:380px;
    text-align:center;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
  }

  input {
    width:130px;
    padding:8px;
    margin:6px;
    border-radius:6px;
    border:none;
    background:#0f0f1a;
    color:white;
    font-size:16px;
  }

  #spinBtn {
    width:220px;
    height:220px;
    background:#4ecca3;
    border:none;
    border-radius:20px;
    font-size:32px;
    font-weight:bold;
    cursor:pointer;
    margin-top:20px;
    transition:0.15s;
  }

  #spinBtn:active {
    transform:scale(0.97);
    background:#3ba987;
  }

  #result {
    margin-top:20px;
    font-size:22px;
    min-height:30px;
  }

  /* Animated multiplier bar */
  #bar {
    width:100%;
    height:14px;
    background:#111;
    border-radius:8px;
    margin-top:20px;
    overflow:hidden;
    position:relative;
  }

  #barFill {
    height:100%;
    width:0%;
    background:linear-gradient(90deg, #ff3d3d, #ffb13d, #4ecca3);
    transition:width 0.15s;
  }
</style>
</head>
<body>

<!-- Back Button -->
<a class="back-btn" href="../launch-deck.html"></a>

<div class="game">
  <h1>Limbo</h1>

  <div>Balance: $<span id="balance">0</span></div>

  <input type="number" id="bet" placeholder="Bet" min="1">
  <br>
  <input type="number" id="mult" placeholder="Target Mult" min="1" step="0.1">

  <button id="spinBtn">SPIN</button>

  <div id="bar"><div id="barFill"></div></div>

  <div id="result"></div>
</div>

<script>
// ---------------- COOKIE HELPERS ----------------
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/";
}

function getCookie(name) {
  const cname = name + "=";
  const arr = decodeURIComponent(document.cookie).split(";");
  for (let c of arr) {
    c = c.trim();
    if (c.indexOf(cname) === 0) return c.substring(cname.length);
  }
  return null;
}

// ---------------- BALANCE ----------------
let balance = 0;

function initBalance() {
  const stored = getCookie("balance");
  if (stored && !isNaN(parseInt(stored))) {
    balance = parseInt(stored);
  } else {
    balance = 1000;
    setCookie("balance", balance, 365);
  }
  updateBalance();
}

function updateBalance() {
  document.getElementById("balance").textContent = balance;
}

function saveBalance() {
  setCookie("balance", balance, 365);
  updateBalance();
}

// ---------------- LIMBO RNG ----------------
function generateMultiplier() {
  const r = Math.random();

  if (r < 0.60) return 1 + Math.random()*9;       // common
  if (r < 0.90) return 10 + Math.random()*40;     // uncommon
  if (r < 0.99) return 50 + Math.random()*150;    // rare
  return 200 + Math.random()*800;                 // ultra rare
}

// ---------------- SPIN ANIMATION ----------------
function animateSpin(callback) {
  let steps = 50;
  let count = 0;

  const interval = setInterval(() => {
    const temp = generateMultiplier();
    document.getElementById("spinBtn").textContent = temp.toFixed(2) + "x";

    // fun bar animation
    const pct = Math.min(100, (temp / 1000) * 100);
    document.getElementById("barFill").style.width = pct + "%";

    count++;
    if (count >= steps) {
      clearInterval(interval);
      callback();
    }
  }, 40);
}

// ---------------- GAME LOGIC ----------------
document.getElementById("spinBtn").onclick = () => {
  const bet = parseFloat(document.getElementById("bet").value);
  const target = parseFloat(document.getElementById("mult").value);
  const resultDiv = document.getElementById("result");

  if (!bet || bet <= 0) {
    resultDiv.textContent = "Enter a valid bet.";
    return;
  }
  if (!target || target <= 0) {
    resultDiv.textContent = "Enter a valid multiplier.";
    return;
  }
  if (bet > balance) {
    resultDiv.textContent = "Not enough balance.";
    return;
  }

  balance -= bet;
  saveBalance();

  resultDiv.textContent = "Spinning...";

  animateSpin(() => {
    const rolled = generateMultiplier();
    document.getElementById("spinBtn").textContent = rolled.toFixed(2) + "x";

    const pct = Math.min(100, (rolled / 1000) * 100);
    document.getElementById("barFill").style.width = pct + "%";

    if (target < rolled) {
      const win = bet * target;
      balance += win;
      saveBalance();
      resultDiv.innerHTML = `<span style="color:#4ecca3;">WIN!</span> Rolled ${rolled.toFixed(2)}x â€” +$${win.toFixed(2)}`;
    } else {
      resultDiv.innerHTML = `<span style="color:#ff4d4d;">LOSS!</span> Rolled ${rolled.toFixed(2)}x`;
    }
  });
};

// ---------------- START ----------------
initBalance();
</script>

</body>
</html>


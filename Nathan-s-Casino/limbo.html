<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Limbo</title>
<style>
  body {
    background:#0f0f1a;
    color:white;
    font-family:Arial;
    display:flex;
    justify-content:center;
    padding-top:40px;
  }
  .game {
    background:#1a1a2e;
    padding:20px;
    border-radius:10px;
    width:350px;
    text-align:center;
  }
  input {
    width:120px;
    padding:6px;
    margin:5px;
    border-radius:5px;
    border:none;
  }
  #spinBtn {
    width:200px;
    height:200px;
    background:#4ecca3;
    border:none;
    border-radius:10px;
    font-size:30px;
    font-weight:bold;
    cursor:pointer;
    margin-top:15px;
  }
  #spinBtn:active {
    background:#3ba987;
  }
  #result {
    margin-top:15px;
    font-size:20px;
    min-height:30px;
  }
</style>
</head>
<body>

<div class="game">
  <h1>Limbo</h1>

  <div>Balance: $<span id="balance">0</span></div>

  <input type="number" id="bet" placeholder="Bet" min="1">
  <br>
  <input type="number" id="mult" placeholder="Target Mult" min="1" step="0.1">

  <br><br>
  <button id="spinBtn">SPIN</button>

  <div id="result"></div>
</div>

<script>
// ---------------- COOKIE HELPERS ----------------
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/";
}

function getCookie(name) {
  const cname = name + "=";
  const arr = decodeURIComponent(document.cookie).split(";");
  for (let c of arr) {
    c = c.trim();
    if (c.indexOf(cname) === 0) return c.substring(cname.length);
  }
  return null;
}

// ---------------- BALANCE ----------------
let balance = 0;

function initBalance() {
  const stored = getCookie("balance");
  if (stored && !isNaN(parseInt(stored))) {
    balance = parseInt(stored);
  } else {
    balance = 1000;
    setCookie("balance", balance, 365);
  }
  updateBalance();
}

function updateBalance() {
  document.getElementById("balance").textContent = balance;
}

function saveBalance() {
  setCookie("balance", balance, 365);
  updateBalance();
}

// ---------------- LIMBO LOGIC ----------------

// rarity-weighted multiplier generator
function generateMultiplier() {
  // Higher numbers are rarer
  // 1–10 common, 10–50 uncommon, 50–200 rare, 200–1000 ultra rare
  const r = Math.random();

  if (r < 0.60) return (1 + Math.random()*9);        // 60% chance
  if (r < 0.90) return (10 + Math.random()*40);      // 30% chance
  if (r < 0.99) return (50 + Math.random()*150);     // 9% chance
  return (200 + Math.random()*800);                  // 1% chance
}

function spinAnimation(callback) {
  let count = 0;
  const interval = setInterval(() => {
    const temp = generateMultiplier();
    document.getElementById("spinBtn").textContent = temp.toFixed(2) + "x";
    count++;
    if (count >= 50) {
      clearInterval(interval);
      callback();
    }
  }, 40);
}

document.getElementById("spinBtn").onclick = () => {
  const bet = parseFloat(document.getElementById("bet").value);
  const target = parseFloat(document.getElementById("mult").value);
  const resultDiv = document.getElementById("result");

  if (!bet || bet <= 0) {
    resultDiv.textContent = "Enter a valid bet.";
    return;
  }
  if (!target || target <= 0) {
    resultDiv.textContent = "Enter a valid multiplier.";
    return;
  }
  if (bet > balance) {
    resultDiv.textContent = "Not enough balance.";
    return;
  }

  // subtract bet immediately
  balance -= bet;
  saveBalance();

  resultDiv.textContent = "Spinning...";

  spinAnimation(() => {
    const rolled = generateMultiplier();
    document.getElementById("spinBtn").textContent = rolled.toFixed(2) + "x";

    if (target < rolled) {
      const win = bet * target;
      balance += win;
      saveBalance();
      resultDiv.textContent = `WIN! Rolled ${rolled.toFixed(2)}x — You won $${win.toFixed(2)}`;
    } else {
      resultDiv.textContent = `LOSS! Rolled ${rolled.toFixed(2)}x`;
    }
  });
};

// ---------------- START ----------------
initBalance();
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Clock Player</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: #e0e8ff;
    font-family: system-ui, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    width: 260px;
    height: 260px;
    overflow: hidden;
  }

  #tabs {
    display: flex;
    border-bottom: 1px solid #222;
  }

  #tabs button {
    flex: 1;
    padding: 4px 0;
    background: #151515;
    border: none;
    color: #9ba4d1;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    cursor: pointer;
  }

  #tabs button.active {
    background: #1f2535;
    color: #e0e8ff;
  }

  .tabPage {
    flex: 1;
    display: none;
    padding: 6px;
    box-sizing: border-box;
  }

  #digitalTab {
    text-align: center;
  }

  .label {
    font-size: 10px;
    color: #7f8bb5;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-top: 4px;
  }

  .value {
    font-size: 18px;
    color: #dfe6ff;
  }

  #analogTab {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #scheduleTab textarea {
    width: 100%;
    height: 150px;
    background: #181a20;
    border: 1px solid #333;
    color: #dfe6ff;
    font-family: monospace;
    font-size: 11px;
    box-sizing: border-box;
    resize: none;
  }

  #scheduleTab button {
    margin-top: 4px;
    width: 100%;
    padding: 4px 0;
    background: #2c3b6b;
    border: none;
    color: #e0e8ff;
    font-size: 11px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="tabs">
  <button id="tabBtnDigital" class="active" onclick="showTab('digitalTab')">Digital</button>
  <button id="tabBtnAnalog" onclick="showTab('analogTab')">Analog</button>
  <button id="tabBtnSchedule" onclick="showTab('scheduleTab')">Schedule</button>
</div>

<div id="digitalTab" class="tabPage" style="display:block;">
  <div class="label">Current</div>
  <div class="value" id="currentTime">--:--:--</div>

  <div class="label">Left</div>
  <div class="value" id="timeLeft">--:--:--</div>

  <div class="label">End</div>
  <div class="value" id="endTime">--:--:--</div>
</div>

<div id="analogTab" class="tabPage">
  <canvas id="analog" width="120" height="120"></canvas>
</div>

<div id="scheduleTab" class="tabPage">
  <div class="label">Schedule (one block per line, e.g. 08:00/08:58)</div>
  <textarea id="scheduleInput"></textarea>
  <button onclick="saveSchedule()">Save Schedule</button>
</div>

<script>
// ---------- Tabs ----------
function showTab(id) {
  document.querySelectorAll('.tabPage').forEach(p => p.style.display = 'none');
  document.getElementById(id).style.display = 'block';

  document.querySelectorAll('#tabs button').forEach(b => b.classList.remove('active'));
  if (id === 'digitalTab') document.getElementById('tabBtnDigital').classList.add('active');
  if (id === 'analogTab') document.getElementById('tabBtnAnalog').classList.add('active');
  if (id === 'scheduleTab') document.getElementById('tabBtnSchedule').classList.add('active');
}

// ---------- Schedule helpers ----------
function getCookie(name) {
  const match = document.cookie.match(new RegExp('(?:^|; )' + name + '=([^;]*)'));
  return match ? decodeURIComponent(match[1]) : "";
}

function setCookie(name, value) {
  document.cookie = name + "=" + encodeURIComponent(value) + "; path=/; max-age=31536000";
}

function parseVisibleSchedule(str) {
  if (!str.trim()) return [];
  return str.trim().split(/\s+/).map(line => {
    const [start, end] = line.split('/');
    return { start, end };
  });
}

function toDate(t) {
  const [h, m] = t.split(':').map(Number);
  const now = new Date();
  return new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0);
}

function expandSchedule(blocks) {
  const full = [];
  for (let i = 0; i < blocks.length; i++) {
    const a = blocks[i];
    full.push(a);
    if (i < blocks.length - 1) {
      const b = blocks[i + 1];
      if (a.end !== b.start) {
        full.push({ start: a.end, end: b.start });
      }
    }
  }
  return full;
}

function formatHMS(ms) {
  if (ms <= 0) return "00:00:00";
  const s = Math.floor(ms / 1000);
  const h = String(Math.floor(s / 3600)).padStart(2, '0');
  const m = String(Math.floor((s % 3600) / 60)).padStart(2, '0');
  const sec = String(s % 60).padStart(2, '0');
  return `${h}:${m}:${sec}`;
}

function formatTime12(d) {
  return d.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', second: '2-digit' });
}

// Load schedule from cookie
let scheduleStr = getCookie('schedule') || "08:00/08:58\n09:02/09:44";
document.getElementById('scheduleInput').value = scheduleStr;
let visibleBlocks = parseVisibleSchedule(scheduleStr);
let blocks = expandSchedule(visibleBlocks);

function saveSchedule() {
  scheduleStr = document.getElementById('scheduleInput').value.trim();
  setCookie('schedule', scheduleStr);
  visibleBlocks = parseVisibleSchedule(scheduleStr);
  blocks = expandSchedule(visibleBlocks);
  alert("Schedule saved.");
}

// ---------- Digital clock ----------
function updateDigital() {
  const now = new Date();
  document.getElementById("currentTime").textContent = formatTime12(now);

  if (!blocks.length) {
    document.getElementById("timeLeft").textContent = "--:--:--";
    document.getElementById("endTime").textContent = "--:--:--";
    return;
  }

  let current = null;
  for (const b of blocks) {
    const s = toDate(b.start);
    const e = toDate(b.end);
    if (now >= s && now <= e) {
      current = { s, e };
      break;
    }
  }

  if (!current) {
    document.getElementById("timeLeft").textContent = "--:--:--";
    document.getElementById("endTime").textContent = "--:--:--";
    return;
  }

  const msLeft = current.e - now;
  document.getElementById("timeLeft").textContent = formatHMS(msLeft);
  document.getElementById("endTime").textContent = formatTime12(current.e);
}

// ---------- Analog clock ----------
const c = document.getElementById("analog");
const ctx = c.getContext("2d");
const r = c.width / 2;

function drawAnalog() {
  ctx.clearRect(0, 0, c.width, c.height);
  ctx.save();
  ctx.translate(r, r);

  ctx.beginPath();
  ctx.arc(0, 0, r - 4, 0, Math.PI * 2);
  ctx.strokeStyle = "#3a6cff";
  ctx.lineWidth = 4;
  ctx.stroke();

  const now = new Date();
  const sec = now.getSeconds();
  const min = now.getMinutes();
  const hr  = now.getHours() % 12;

  ctx.save();
  ctx.rotate((Math.PI/6)*hr + (Math.PI/360)*min);
  ctx.strokeStyle = "#dfe6ff";
  ctx.lineWidth = 5;
  ctx.beginPath();
  ctx.moveTo(0, 10);
  ctx.lineTo(0, -30);
  ctx.stroke();
  ctx.restore();

  ctx.save();
  ctx.rotate((Math.PI/30)*min + (Math.PI/1800)*sec);
  ctx.strokeStyle = "#9bb4ff";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(0, 12);
  ctx.lineTo(0, -45);
  ctx.stroke();
  ctx.restore();

  ctx.save();
  ctx.rotate((Math.PI/30)*sec);
  ctx.strokeStyle = "#3a6cff";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(0, 15);
  ctx.lineTo(0, -50);
  ctx.stroke();
  ctx.restore();

  ctx.restore();
}

// ---------- Loop ----------
setInterval(() => {
  updateDigital();
  drawAnalog();
}, 1000);

updateDigital();
drawAnalog();
</script>

</body>
</html>

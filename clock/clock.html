<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clock</title>
  <link rel="icon" type="image/png" href="../icon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; color:#eee; background:#071018; }
    h1 { margin-bottom: 1rem; }
    h2 { margin: 0.5rem 0 0.2rem; color:#00aaff; }
    .clock { font-size: 2rem; font-weight: bold; }
    textarea { width:100%; height:120px; margin-top:1rem; font-family:monospace; }
    button { margin-top:0.5rem; padding:6px 12px; border-radius:6px; cursor:pointer; }
    footer { margin-top:2rem; font-size:14px; color:#7fbfdc; text-align:center; }
  </style>
</head>
<body>
  <a href="../launch-deck.html" style="position: fixed; top: 12px; left: 12px; z-index: 100;">
    <img src="../icon.png" alt="" style="height: 60px; background: black; border-radius: 4px;">
  </a>
  <h1>.</h1>
  <h1>Clock</h1>

  <h2>Current</h2>
  <div class="clock" id="current">--:--:--</div>

  <h2>Left (until next start)</h2>
  <div class="clock" id="left">--:--:--</div>

  <h2>Next Start</h2>
  <div class="clock" id="end">--:--:--</div>

  <p>Enter schedule lines (<code>start/end</code> times like <code>8:00/8:58</code>, one per line):</p>
  <textarea id="scheduleBox"></textarea><br/>
  <button onclick="applySchedule()">Apply Schedule</button>
  <button onclick="resetSchedule()">Reset Schedule</button>

  <footer>
    <p>Made by Nathan Marty</p>
  </footer>

<script>
let periods = [];
const defaultSchedule = `08:00/08:58
09:02/09:44
09:48/10:30
10:34/11:16
11:20/12:23
12:27/13:25
13:29/14:27
14:31/15:30
15:30/32:00`;

function setCookie(name,value,days){
  const d = new Date();
  d.setTime(d.getTime()+(days*24*60*60*1000));
  document.cookie = name+"="+encodeURIComponent(value)+";expires="+d.toUTCString()+";path=/";
}
function getCookie(name){
  const cname = name+"=";
  const decoded = decodeURIComponent(document.cookie);
  const arr = decoded.split(";");
  for(let c of arr){
    c = c.trim();
    if(c.indexOf(cname)===0) return c.substring(cname.length);
  }
  return "";
}

function toSeconds(t){
  const [h,m] = t.split(":").map(Number);
  return h*3600 + m*60;
}
function formatClock(h,m,s){
  let hrs = h;
  let ampm = hrs >= 12 ? "PM" : "AM";
  hrs = hrs % 12; if (hrs===0) hrs=12;
  return `${hrs}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")} ${ampm}`;
}
function formatDuration(sec){
  if(sec<0) return "--:--:--";
  const hrs = String(Math.floor(sec/3600)).padStart(2,"0");
  const mins = String(Math.floor((sec%3600)/60)).padStart(2,"0");
  const secs = String(sec%60).padStart(2,"0");
  return `${hrs}:${mins}:${secs}`;
}

function applySchedule(){
  const text = document.getElementById("scheduleBox").value.trim();
  setCookie("schedule", text, 365);
  const lines = text.split(/\n+/);
  periods = [];
  for(const line of lines){
    const parts = line.split("/");
    if(parts.length===2){
      try{
        const start = toSeconds(parts[0].trim());
        const end = toSeconds(parts[1].trim());
        periods.push([start,end]);
      }catch(e){}
    }
  }
}
function resetSchedule(){
  document.getElementById("scheduleBox").value = defaultSchedule;
  applySchedule();
}

function updateClock(){
  const now = new Date();
  const currentSec = now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds();
  const current = formatClock(now.getHours(), now.getMinutes(), now.getSeconds());

  let left="--:--:--", end="--:--:--";

  if(periods.length>0){
    for(let i=0;i<periods.length;i++){
      const [start,endSec] = periods[i];
      if(currentSec>=start && currentSec<=endSec){
        // inside a period
        let targetEnd = endSec;
        if(i+1<periods.length){
          targetEnd = periods[i+1][0]; // extend countdown to next start
        }
        left = formatDuration(targetEnd-currentSec);

        const endDate = new Date(now);
        endDate.setHours(Math.floor(targetEnd/3600), Math.floor((targetEnd%3600)/60), targetEnd%60);
        end = formatClock(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());
        break;
      }
    }
  }

  document.title = `${left}/${current}`;
  document.getElementById("current").textContent = current;
  document.getElementById("left").textContent = left;
  document.getElementById("end").textContent = end;
}

window.onload = function(){
  const saved = getCookie("schedule");
  document.getElementById("scheduleBox").value = saved || defaultSchedule;
  applySchedule();
  setInterval(updateClock,1000);
  updateClock();
};
</script>
</body>
</html>

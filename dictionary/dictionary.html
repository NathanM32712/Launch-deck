<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dictionary Search</title>
<link rel="icon" type="image/png" href="../icon.png">

<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #results { margin-top: 20px; white-space: pre-wrap; }
    mark { background: yellow; font-weight: bold; }
    #backBtn {
        position: fixed;
        top: 10px;
        left: 10px;
        width: 40px;
        height: 40px;
        cursor: pointer;
    }
</style>
</head>
<body>

<a href="../launch-deck">
    <img id="backBtn" src="../icon.png">
</a>

<h2>Dictionary Search</h2>

<!-- Optional: user can still upload extra .txt files -->
<input type="file" id="fileInput" accept=".txt" multiple>
<br><br>

<input id="searchBox" type="text" placeholder="Search..." style="width:300px;">
<div id="results"></div>

<script>
let lines = [];

// Load dictionary.txt automatically
function loadMainDictionary() {
    fetch("dictionary.txt")
        .then(r => r.text())
        .then(t => {
            lines.push(...t.split(/\r?\n/));
            console.log("Loaded dictionary.txt");
        })
        .catch(err => console.log("dictionary.txt not found"));
}

// Load user-selected files
document.getElementById("fileInput").addEventListener("change", function() {
    const files = this.files;

    for (let file of files) {
        const reader = new FileReader();
        reader.onload = function(e) {
            lines.push(...e.target.result.split(/\r?\n/));
        };
        reader.readAsText(file);
    }
});

// Live search
document.getElementById("searchBox").addEventListener("input", search);

function search() {
    const query = document.getElementById("searchBox").value.trim().toLowerCase();
    if (!query || lines.length === 0) {
        document.getElementById("results").innerHTML = "";
        return;
    }

    let resultsHTML = "";
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].toLowerCase();

        if (line.includes(query)) {
            const start = Math.max(0, i - 3);
            const end = Math.min(lines.length - 1, i + 3);

            let snippet = lines.slice(start, end + 1).join("\n");

            const regex = new RegExp(query, "gi");
            snippet = snippet.replace(regex, match => `<mark>${match}</mark>`);

            resultsHTML += `<pre>${snippet}</pre><hr>`;
        }
    }

    document.getElementById("results").innerHTML = resultsHTML || "No matches found.";
}

// Load dictionary.txt on startup
loadMainDictionary();
</script>

</body>
</html>

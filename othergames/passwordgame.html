<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Password Game</title>
  <link rel="icon" type="image/png" href="../icon.png">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#000;
      --accent:#00aaff;
      --accent-2:#00ccff;
      --good:#00ff88;
      --warn:#ffaa00;
      --bad:#ff4444;
      --panel:#111;
      --text:#cfefff;
    }
    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
      padding:24px;
      box-sizing:border-box;
    }
    header{display:flex;align-items:center;gap:16px}
    .back-button img{width:40px;height:40px}
    h1{flex:1;text-align:center;color:var(--accent-2);margin:0 8px}
    .container{max-width:980px;margin:18px auto}
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center}
    input#password{
      width:520px;max-width:100%;
      padding:12px 14px;border-radius:6px;border:2px solid var(--accent);
      background:var(--panel);color:var(--accent-2);font-size:16px;
      outline:none;box-sizing:border-box;
    }
    .info{
      display:flex;gap:12px;align-items:center;margin-top:12px;justify-content:center;
      color:var(--text);font-weight:600;
    }
    .badge{padding:6px 10px;border-radius:999px;background:#071018;color:var(--accent);border:1px solid rgba(0,170,255,0.12)}
    .rules-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:8px;margin-top:18px;
    }
    .rule{
      padding:10px 12px;border-radius:6px;background:#070809;border:1px solid rgba(255,255,255,0.03);
      font-size:14px;display:flex;align-items:center;gap:10px;
    }
    .rule .dot{width:12px;height:12px;border-radius:50%}
    .rule.pass{border-color:rgba(0,255,136,0.12);color:var(--good)}
    .rule.pass .dot{background:var(--good);box-shadow:0 0 6px rgba(0,255,136,0.12)}
    .rule.fail{border-color:rgba(255,68,68,0.08);color:var(--bad)}
    .rule.fail .dot{background:var(--bad);opacity:0.9}
    .status{margin-top:18px;text-align:center;font-weight:700;font-size:1.05rem}
    /* cover */
    #cover{
      display:none;position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.96),rgba(0,0,0,0.98));
      z-index:9999;color:var(--good);font-size:clamp(20px,4vw,36px);
      display:flex;align-items:center;justify-content:center;flex-direction:column;gap:18px;
    }
    #cover .card{background:#071018;padding:28px;border-radius:12px;border:1px solid rgba(0,255,136,0.08);text-align:center}
    #cover button{margin-top:8px;padding:8px 14px;border-radius:8px;border:0;background:var(--good);color:#002;cursor:pointer;font-weight:700}
    footer{margin-top:22px;text-align:center;color:#6fb7d9;font-size:13px}
    @media (max-width:420px){input#password{font-size:15px;padding:10px}}
  </style>
</head>
<body>
  <header>
    <div class="back-button">
      <a href="../launch-deck.html"><img src="../icon.png" alt="Back"></a>
    </div>
    <h1>Chaotic Password Game</h1>
  </header>

  <main class="container">
    <div class="controls">
      <input id="password" type="text" autocomplete="off" placeholder="Type your chaotic password...">
    </div>

    <div class="info" aria-live="polite">
      <div class="badge" id="lenBadge">Length: 0</div>
      <div class="badge" id="failBadge" style="color:var(--bad);border-color:rgba(255,68,68,0.08)">Fails: 35</div>
      <div class="badge" id="primeBadge">Prime: no</div>
    </div>

    <div id="rules" class="rules-grid" aria-hidden="false"></div>

    <div id="status" class="status">Start typing to test rules. Press Enter to finish when you have â‰¤ 1 fail.</div>
  </main>

  <div id="cover" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="card">
      <div style="font-size:1.4em">ðŸŽ‰ Done!</div>
      <div style="margin-top:6px;color:#bfffdc;font-weight:600">You beat the chaotic password game.</div>
      <div style="margin-top:10px;font-size:0.95em;color:#9fe6c9">Press Close to continue playing or Esc to dismiss.</div>
      <button id="closeCover">Close</button>
    </div>
  </div>

  <footer>All 35 rules are visible and update live.</footer>

  <script>
    // helper: primality
    function isPrime(n){
      if (typeof n !== 'number' || n < 2) return false;
      if (n % 2 === 0) return n === 2;
      const r = Math.floor(Math.sqrt(n));
      for (let i = 3; i <= r; i += 2) if (n % i === 0) return false;
      return true;
    }

    // rules array (all 35)
    const rules = [
      { text: "Rule 1: Must be at least 5 characters", check: pw => pw.length >= 5 },
      { text: "Rule 2: Must include a number", check: pw => /\d/.test(pw) },
      { text: "Rule 3: Must include an uppercase letter", check: pw => /[A-Z]/.test(pw) },
      { text: "Rule 4: Must include a lowercase letter", check: pw => /[a-z]/.test(pw) },
      { text: "Rule 5: Must include a special character (!@#$%^&*)", check: pw => /[!@#$%^&*]/.test(pw) },
      { text: "Rule 6: Must contain today's date (12/17)", check: pw => pw.includes('12/17') },
      { text: "Rule 7: Must spell a planet", check: pw => /(Mercury|Venus|Earth|Mars|Jupiter|Saturn|Uranus|Neptune)/i.test(pw) },
      { text: "Rule 8: Length must be prime", check: pw => isPrime(pw.length) },
      { text: "Rule 9: Must contain a Roman numeral", check: pw => /\b(M{0,3}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}))\b/.test(pw) },
      { text: "Rule 10: Must include 'egg'", check: pw => /egg/i.test(pw) },
      { text: "Rule 11: Must contain a PokÃ©mon name", check: pw => /(Pikachu|Charmander|Bulbasaur|Squirtle|Eevee|Snorlax)/i.test(pw) },
      { text: "Rule 12: Must include a chess piece", check: pw => /(King|Queen|Rook|Bishop|Knight|Pawn)/i.test(pw) },
      { text: "Rule 13: Must contain an emoji", check: pw => /[\u{1F300}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{2600}-\u{26FF}]/u.test(pw) },
      { text: "Rule 14: Must include 'banana'", check: pw => /banana/i.test(pw) },
      { text: "Rule 15: Must spell a color", check: pw => /\b(red|blue|green|yellow|purple|orange|black|white|pink|brown|gray)\b/i.test(pw) },
      { text: "Rule 16: Digits must sum to 21", check: pw => {
          const sum = pw.split('').filter(c=>/\d/.test(c)).reduce((a,b)=>a+parseInt(b,10),0);
          return sum === 21;
        }
      },
      { text: "Rule 17: Must contain an equation (like 2+2=4)", check: pw => /\d+\s*\+\s*\d+\s*=\s*\d+/.test(pw) },
      { text: "Rule 18: Must include âˆš", check: pw => pw.includes('âˆš') || pw.includes('sqrt') },
      { text: "Rule 19: Must contain a fraction (e.g. 1/2)", check: pw => /\b\d+\/\d+\b/.test(pw) },
      { text: "Rule 20: Must include 'infinity'", check: pw => /infinity|âˆž/i.test(pw) },
      { text: "Rule 21: Must contain a Harry Potter spell", check: pw => /(Expelliarmus|Lumos|Accio|Expecto Patronum|Alohomora)/i.test(pw) },
      { text: "Rule 22: Must include 'racecar'", check: pw => /racecar/i.test(pw) },
      { text: "Rule 23: Must contain 'meme'", check: pw => /meme/i.test(pw) },
      { text: "Rule 24: Must include a landmark", check: pw => /(Eiffel|Pyramids|Colosseum|Statue of Liberty|Big Ben|Great Wall|Taj Mahal|Machu Picchu|Christ the Redeemer|Stonehenge|Sydney Opera House)/i.test(pw) },
      { text: "Rule 25: Must spell an animal", check: pw => /\b(cat|dog|lion|tiger|bear|shark|elephant|wolf)\b/i.test(pw) },
      { text: "Rule 26: Must include zodiac sign", check: pw => /(Aries|Taurus|Gemini|Cancer|Leo|Virgo|Libra|Scorpio|Sagittarius|Capricorn|Aquarius|Pisces)/i.test(pw) },
      { text: "Rule 27: Must contain 'chaos'", check: pw => /chaos/i.test(pw) },
      { text: "Rule 28: Must include 3 identical letters in a row", check: pw => /(.)\1\1/.test(pw) },
      { text: "Rule 29: Must contain a country name", check: pw => /\b(USA|United States|Canada|France|Japan|Brazil|Germany|Australia)\b/i.test(pw) },
      { text: "Rule 30: Must include 'pizza'", check: pw => /pizza/i.test(pw) },
      { text: "Rule 31: Must contain Pi (3.1415)", check: pw => /3\.1415/.test(pw) },
      { text: "Rule 32: Must include 'launch'", check: pw => /launch/i.test(pw) },
      { text: "Rule 33: Must spell a day of the week", check: pw => /\b(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)\b/i.test(pw) },
      { text: "Rule 34: Must include a hex color (#FF0000)", check: pw => /#[0-9A-Fa-f]{6}/.test(pw) },
      { text: "Rule 35: Must end with 'done'", check: pw => /done$/.test(pw) }
    ];

    // render rules initially (different route: render once, update classes)
    const rulesDiv = document.getElementById('rules');
    rules.forEach((r, idx) => {
      const el = document.createElement('div');
      el.className = 'rule fail';
      el.id = 'rule-' + (idx+1);
      el.innerHTML = `<span class="dot" aria-hidden="true"></span><span class="text">${r.text}</span>`;
      rulesDiv.appendChild(el);
    });

    const input = document.getElementById('password');
    const lenBadge = document.getElementById('lenBadge');
    const failBadge = document.getElementById('failBadge');
    const primeBadge = document.getElementById('primeBadge');
    const status = document.getElementById('status');
    const cover = document.getElementById('cover');
    const closeCover = document.getElementById('closeCover');

    // update function
    function update(pw){
      let fails = 0;
      rules.forEach((r, i) => {
        let passed = false;
        try { passed = !!r.check(pw); } catch(e){ passed = false; }
        const el = document.getElementById('rule-' + (i+1));
        el.className = 'rule ' + (passed ? 'pass' : 'fail');
        if (!passed) fails++;
      });

      lenBadge.textContent = 'Length: ' + pw.length;
      failBadge.textContent = 'Fails: ' + fails;
      primeBadge.textContent = 'Prime: ' + (isPrime(pw.length) ? 'yes' : 'no');

      if (fails === 0) {
        status.textContent = 'âœ… Perfect! All rules satisfied.';
        status.style.color = 'var(--good)';
      } else if (fails === 1) {
        status.textContent = 'ðŸ†“ Freebie used! Password accepted with one failed rule.';
        status.style.color = 'var(--warn)';
      } else {
        status.textContent = `âŒ Password fails ${fails} rules.`;
        status.style.color = 'var(--bad)';
      }

      return fails;
    }

    // initial update with empty password so all rules show
    let currentFails = update('');

    // live updates
    input.addEventListener('input', () => {
      currentFails = update(input.value);
    });

    // Enter behavior: show cover if <=1 fail
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        if (currentFails <= 1) {
          cover.style.display = 'flex';
          cover.setAttribute('aria-hidden','false');
          // focus close button for accessibility
          closeCover.focus();
        } else {
          // small feedback shake or message
          status.textContent = `Not ready â€” ${currentFails} rules still failing.`;
          status.style.color = 'var(--bad)';
        }
      }
    });

    // dismiss cover
    closeCover.addEventListener('click', () => {
      cover.style.display = 'none';
      cover.setAttribute('aria-hidden','true');
      input.focus();
    });

    // allow Esc to close cover
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && cover.style.display === 'flex') {
        cover.style.display = 'none';
        cover.setAttribute('aria-hidden','true');
        input.focus();
      }
    });

    // make cover clickable outside card to dismiss
    cover.addEventListener('click', (ev) => {
      if (ev.target === cover) {
        cover.style.display = 'none';
        cover.setAttribute('aria-hidden','true');
        input.focus();
      }
    });

    // keep focus on input on load
    window.addEventListener('load', () => input.focus());
  </script>
</body>
</html>
